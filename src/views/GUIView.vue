<template>
    <div class="gui-page">
        <header class="gui-page__header">
            <h1>–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–ª—è chat</h1>
        </header>

        <main class="gui-page__content">
            <div class="gui-page__component-list">
                <div class="gui-page__component-item">
                    <h3 class="gui-page__component-title">–ò–∫–æ–Ω–∫–∏</h3>
                    <div class="gui-page__component-icons">
                        <icon-base icon-name="call" />
                        <icon-base icon-name="emoji" />
                        <icon-base icon-name="check" />
                        <icon-base icon-name="menu" />
                        <icon-base icon-name="more" />
                        <icon-base icon-name="search" />
                        <icon-base icon-name="send" />
                        <icon-base icon-name="verified" />
                    </div>
                </div>

                <div class="gui-page__component-item">
                    <h3 class="gui-page__component-title">–ö–Ω–æ–ø–∫–∏</h3>
                    <div class="gui-page__component-button">
                        <ButtonComponent
                            text="–ö–Ω–æ–ø–∫–∞ —Å –∏–∫–æ–Ω–∫–æ–π —Å–ª–µ–≤–∞"
                            prefixIcon
                            iconName="call"
                            widthIcon="15"
                            heightIcon="15"
                        />
                        <ButtonComponent
                            text="–ö–Ω–æ–ø–∫–∞ —Å –∏–∫–æ–Ω–∫–æ–π —Å–ø—Ä–∞–≤–∞"
                            suffixIcon
                            iconName="call"
                            widthIcon="15"
                            heightIcon="15"
                        />
                        <ButtonComponent
                            text="–ö–Ω–æ–ø–∫–∞ —Å —Ç–µ–º–æ–π blue –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é"
                            prefixIcon
                            iconName="call"
                            widthIcon="15"
                            heightIcon="15"
                        />
                        <ButtonComponent
                            text="–ö–Ω–æ–ø–∫–∞ —Å —Ç–µ–º–æ–π grey"
                            suffixIcon
                            iconName="call"
                            widthIcon="15"
                            heightIcon="15"
                            theme="grey"
                        />
                        <ButtonComponent
                            text="–û—Ç–∫–ª—é—á–µ–Ω–Ω–∞—è –∫–Ω–æ–ø–∫–∞"
                            prefixIcon
                            iconName="call"
                            widthIcon="15"
                            heightIcon="15"
                            disabled
                        />
                    </div>
                </div>

                <div class="gui-page__component-item">
                    <h3 class="gui-page__component-title">–ü–æ–ª—è –≤–≤–æ–¥–∞</h3>
                    <div class="gui-page__component-input">
                        <InputComponent
                            v-model="msg"
                        />

                        <InputComponent 
                            placeholder="–ü–æ–∏—Å–∫"
                            circle
                            size="small"
                            theme="grey"
                            prefixElement
                        >
                            <template #prefixElement>
                                <icon-base
                                    icon-name="search"
                                    icon-color="#707991"
                                />
                            </template>
                        </InputComponent>

                        <InputComponent 
                            placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"
                            prefixElement
                            suffixElement
                        >
                            <template #prefixElement>
                                <icon-base
                                    icon-name="emoji"
                                    icon-color="#707991"
                                />
                            </template>

                            <template #suffixElement>
                                <icon-base
                                    icon-name="send"
                                    icon-color="#8BABD8"
                                />
                            </template>
                        </InputComponent>

                        <InputComponent 
                            placeholder="–û—Ç–∫–ª—é—á–µ–Ω–Ω—ã–π –≤–≤–æ–¥"
                            disabled
                        />
                    </div>
                </div>

                <div class="gui-page__component-item">
                    <h3 class="gui-page__component-title">–ê–≤–∞—Ç–∞—Ä</h3>
                    <div class="gui-page__component-avatar">
                        <AvatarComponent photoName="avatar-5.jpg" size="small" />
                        <AvatarComponent photoName="avatar-5.jpg" />

                        <AvatarComponent size="small" stubText="–¢–µ–∫—Å—Ç"/>
                        <AvatarComponent stubText="–¢–µ–∫—Å—Ç"/>
                    </div>
                </div>

                <div class="gui-page__component-item">
                    <h3 class="gui-page__component-title">–ß–∞—Ç</h3>
                    <div class="gui-page__component-chat" v-for="chat in chatsData" :key="chat.id">
                        <ChatItemComponent
                            :chat="formatChat(chat)"
                        />
                    </div>
                </div>

                <div class="gui-page__component-item">
                    <h3 class="gui-page__component-title">–°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤</h3>
                    <div class="gui-page__component-chat-list">
                        <ChatListComponent 
                            :chats="chatsData"
                        />
                    </div>
                </div>

                <div class="gui-page__component-item">
                    <h3 class="gui-page__component-title">Top bar</h3>
                    <div class="gui-page__component-top-bar">
                        <TopBarComponent
                            :user="chatsData[5]"
                            @searchClick="searchClickHandler"
                            @callClick="callClickHandler"
                            @optionsClick="optionsClickHandler"
                        />
                    </div>
                </div>

                <div class="gui-page__component-item">
                    <h3 class="gui-page__component-title">Message</h3>
                    <div class="gui-page__component-message">
                        <MessageComponent
                            :message="chatsData[5].messages[0]"
                        />
                        <MessageComponent
                            :message="chatsData[5].messages[0]"
                            theme="white"
                        />
                    </div>
                </div>

                <div class="gui-page__component-item">
                    <h3 class="gui-page__component-title">Messages List</h3>
                    <div class="gui-page__component-message-list">
                        <MessagesListComponent
                            :messages="chatsData[5].messages"
                        />
                    </div>
                </div>

                <div class="gui-page__component-item">
                    <h3 class="gui-page__component-title">Sidebar</h3>
                    <div class="gui-page__component-sidebar">
                        <ChatSidebarComponent
                            v-model="searchSidebar"
                            :chats="chatsData"
                        />
                    </div>
                </div>
            </div>
        </main>
    </div>
</template>

<script setup>
import IconBase from '@/components/IconBase.vue';
import ButtonComponent from '@/components/ButtonComponent.vue';
import InputComponent from '@/components/InputComponent.vue';
import AvatarComponent from '@/components/AvatarComponent.vue';
import ChatItemComponent from '@/components/ChatItemComponent.vue';
import ChatListComponent from '@/components/ChatListComponent.vue';
import TopBarComponent from '@/components/TopBarComponent.vue';
import MessageComponent from '@/components/MessageComponent.vue';
import MessagesListComponent from '@/components/MessagesListComponent.vue';
import ChatSidebarComponent from '@/components/ChatSidebarComponent.vue';

import { ref } from 'vue';

const msg = ref('Hello World!');
const searchSidebar = ref('');

const formatChat = (chat) => {
	const lastMessage = chat.messages.at(-1);

	const unReadMessagesCount = chat.messages.filter((message)=> !message.read).length;
    
	const formatedChat = {
		id: chat.id,
		...(chat.avatar_url) && { avatar_url: chat.avatar_url },
		...(chat.name) && { name: chat.name },
		verified: chat.verified,
		unreadMessagesCount: unReadMessagesCount,
	};

	if (lastMessage) { formatedChat.lastMessage = lastMessage; }

	return formatedChat;
};

const chatsData = ref([
	{
		id: 1,
		avatar_url: '',
		name: 'New chat',
		verified: false,
		messages: [],
	},
	{
		id: 2,
		avatar_url: 'avatar-7.jpg',
		name: 'New chat',
		verified: false,
		messages: [
			{
				id: 1,
				text: 'message',
				date: '14:00',
				read: true,
			},
		],
	},
	{
		id: 3,
		avatar_url: 'avatar-1.jpg',
		name: '–ß–∞—Ç 2',
		verified: false,
		messages: [
			{
				id: 1,
				text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.',
				date: '18:28',
			},
			{
				id: 2,
				text: '–û–∫, —É–≤–∏–¥–∏–º—Å—è',
				date: '18:30',
			},
		],
	},
	{
		id: 4,
		avatar_url: 'avatar-5.jpg',
		name: 'New chat',
		verified: false,
		messages: [
			{
				id: 1,
				text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.',
				date: '20:30',
			},
		],
	},
	{
		id: 5,
		avatar_url: '',
		name: 'Satoru Gojo',
		verified: true,
		messages: [
			{
				id: 1,
				text: '–ü—Ä–∏–±—ã–ª',
				date: '20:31',
				read: true,
			},
		],
	},
	{
		id: 6,
		avatar_url: 'avatar-2.png',
		name: 'David Moore',
		verified: true,
		online_status: '–≤ —Å–µ—Ç–∏ 5 –º–∏–Ω –Ω–∞–∑–∞–¥',
		messages: [
			{
				id: 1,
				text: '–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µüòê',
				date: '2024-06-24T11:30:38.538Z',
			},
			{
				id: 2,
				text: '–ü—Ä–∏–≤–µ—Ç, –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç',
				date: '2024-06-24T11:31:38.538Z',
			},
			{
				id: 3,
				text: '–ù—É –≤—Å–µ, –º–æ–∂–Ω–æ —Ä–∞—Å—Ö–æ–¥–∏—Ç—å—Å—è üòÑ',
				date: '2024-06-24T11:32:38.538Z',
			},
		],
	},
]);

const searchClickHandler = () => {
	console.log('–ö–ª–∏–∫ –ø–æ –ø–æ–∏—Å–∫—É');
};
const callClickHandler = () => {
	console.log('–ö–ª–∏–∫ –ø–æ —Ç—Ä—É–±–∫–µ');
};
const optionsClickHandler = () => {
	console.log('–ö–ª–∏–∫ –ø–æ –æ–ø—Ü–∏—è–º');
};

</script>

<style scoped lang="scss">
.gui-page {
    display: flex;
    flex-direction: column;

    min-height: 100vh;
    max-width: 1280px;
    margin: 0 auto;

    &__header {
        line-height: 30px;
        
        position: fixed;
        top: 0;
        right: 0;
        left: 0;

        display: flex;
        align-items: center;

        max-width: 1280px;
        height: 110px;
        margin: 0 auto;
        padding: 0 20px;

        border-bottom: 1px solid #eaecef;
        background-color: white;

        z-index: 10;

        @media #{$screen-tablet} {
            height: 70px;
        }
    }

    &__content {
        flex-grow: 1;

        margin-top: 120px;
        padding: 0 20px;

        @media #{$screen-tablet} {
            margin-top: 80px;
        }
    }

    &__component {
        &-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        &-item {
            display: flex;
            flex-direction: column;
            gap: 10px;

            padding-bottom: 10px;

            border-bottom: 1px dashed #eaecef;

            &:last-child {
                margin-bottom: 70px;
            }
        }

        &-title {
            color: #8f8fff;
        }

        &-icons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        &-button {            
            display: flex;
            flex-direction: column;
            flex-wrap: wrap;
        }

        &-input {
            display: flex;
            flex-direction: column;
            gap: 10px;

            padding: 20px;

            background-color: #8f8fff26;
            border-radius: 12px;
        }

        &-avatar {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        &-chat {
            display: flex;
            flex-direction: column;
            gap: 10px;

            padding: 20px;

            background-color: #8f8fff26;
            border-radius: 12px;

            &-list {
                border: 1px solid  #8f8fff26;
                background-color: #8f8fff26;
            }
        }

        &-top-bar {
            padding: 20px;

            background-color: #8f8fff26;
            border-radius: 12px;
        }

        &-message {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 20px;

            background-color: #8f8fff26;
            border-radius: 12px;
            
            &-list {
                padding: 20px;

                background-color: #8f8fff26;
                border-radius: 12px;
            }
        }

        &-sidebar {
            height: 300px;
            padding: 20px;

            background-color: #8f8fff26;
            border-radius: 12px;
        }
    }
}
</style>
